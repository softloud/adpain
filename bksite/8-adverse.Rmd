# Adverse events

# Adverse events

```{r eval=FALSE}
subgroup_type %>% 
  filter(outcome == "adverse") %>% 
  

```


***


```{r }
this_key_row <- 
subgroup_type %>% 
  filter(
    outcome == "adverse",
    timepoint == "post_int",
    type == "ad"
  )

```


```{r eval=FALSE}
nma_adverse <- 
  pres_nma(this_key_row)

write_pres_nma(nma_adverse, this_key_row)

```

```{r}
nma_adverse <- read_rds("/home/cantabile/Documents/gh-repos/adpain/data/pres/subgroup_type_adverse_ad_post_int_.rds")

```

```{r}
nma_adverse_plot <- make_forest(nma_adverse, this_key_row) 

```


```{r}
nma_adverse_plot + 
  facet_grid(class ~ ., scales = "free", space = "free") +
  coord_cartesian(xlim = c(-2, 4))

```

## Adverse events and SNRI

### Only post-intervention results

### Pair-wise comparisons

```{r}
this_pw <- 
pw_results %>% 
  filter(
    subgroup == "subgroup_class",
    outcome == "adverse",
    class == "snri"
  ) %>% 
  arrange(desc(participants), desc(n_studies)) 

this_pw %>% 
  select(comp, n_studies, participants) %>% 
  rename_with(str_to_sentence, everything()) %>% 
  gt() %>% 
  tab_header("Pairwise comparisons of adverse pain for SNRI") %>% 
  cols_label(
    N_studies = "Studies",
    Comp = "Comparison"
  ) %>% 
  tab_options(row_group.background.color = hpp_pal(1)
    
  )


```


***

```{r}
make_forest(nma_adverse, this_key_row, this_class = "snri") 

```

***

```{r}
this_pw$pw_forest_file[1] %>% read_rds()

```

*** 

```{r}
this_pw$pw_forest_file[2] %>% read_rds() +
  coord_cartesian(xlim = c(-0.5, 5))

```

*** 

```{r}
this_pw$pw_forest_file[3] %>% read_rds()

```

*** 

```{r}
this_pw$pw_forest_file[4] %>% read_rds()

```

*** 

```{r}
this_pw$pw_forest_file[5] %>% read_rds()

```

## Adverse events & TCA

***

```{r}
make_forest(nma_adverse, this_key_row, this_class = "tca") +
  coord_cartesian(xlim = c(-0.5, 15))

```

## Direct evidence for TCA with adverse events

```{r}
this_pw <- 
pw_results %>% 
  filter(
    subgroup == "subgroup_class",
    outcome == "adverse",
    class == "tca"
  ) %>% 
  arrange(desc(participants), desc(n_studies)) 

this_pw %>% 
  select(comp, n_studies, participants) %>% 
  rename_with(str_to_sentence, everything()) %>% 
  gt() %>% 
  tab_header("Pairwise comparisons of adverse pain for SNRI") %>% 
  cols_label(
    N_studies = "Studies",
    Comp = "Comparison"
  ) %>% 
  tab_options(row_group.background.color = hpp_pal(1)
    
  )

```

***

```{r}
this_pw$pw_forest_file[1] %>% read_rds() +
  coord_cartesian(xlim = c(-0.5, 20))

```


***

```{r}
this_pw$pw_forest_file[2] %>% read_rds()

```

## No pairwise analyses available for SSRI

***

```{r}
make_forest(nma_adverse, this_key_row, this_class = "ssri") +
  coord_cartesian(xlim = c(-0.5, 15))

```

## No direct evidence for adverse events by condition

## Adverse events and dose

```{r}
this_pw <- 
pw_results %>% 
  filter(
    subgroup == "subgroup_dose",
    outcome == "adverse"
  ) %>% 
  arrange(desc(participants), desc(n_studies)) 

this_pw %>% 
  select(comp, n_studies, participants, dose, int_2) %>% 
  rename_with(str_to_sentence, everything()) %>% 
  gt(groupname_col = "Int_2") %>% 
  tab_header("Direct evidence for conditions") %>% 
  cols_label(
    N_studies = "Studies",
    Comp = "Comparison"
  ) %>% 
  tab_options(row_group.background.color = hpp_pal(1)
    
  )


```

## Adverse events for duloxetine by dose

***

```{r}
this_pw %>% 
  filter(dose == "high", str_detect(comp, "dulox")) %>% 
  pull(pw_forest_file) %>% 
  read_rds()

```

***

```{r}
this_pw %>% 
  filter(dose == "standard", str_detect(comp, "dulox")) %>% 
  pull(pw_forest_file) %>% 
  read_rds()

```

## Adverse events and conditions

```{r}
this_pw <- 
pw_results %>% 
  filter(
    outcome == "adverse",
    subgroup == "subgroup_con"
  ) %>% 
  arrange(desc(participants), desc(n_studies))

this_pw %>% 
  select(condition, comp, n_studies, participants) %>% 
  gt(
    groupname_col = "condition"
  ) %>% 
  tab_header("Direct evidence by condition") %>% 
  tab_options(row_group.background.color = hpp_pal(1)
  ) %>% 
  cols_label(
    comp = "Comparison",
    n_studies = "Studies",
    participants = "Participants"
  )


```

## Adverse events and fibromyalgia

```{r}
this_pw %>% 
  filter(str_detect(condition, "fibro")) %>% 
    select(condition, comp, n_studies, participants) %>% 
  gt(
    groupname_col = "condition"
  ) %>% 
  tab_header("Direct evidence by condition") %>% 
  tab_options(row_group.background.color = hpp_pal(1)
  ) %>% 
  cols_label(
    comp = "Comparison",
    n_studies = "Studies",
    participants = "Participants"
  )



```


***

```{r}
this_pw %>% 
  filter(str_detect(condition, "fibro")) %>% 
  slice(1) %>% 
  pull(pw_forest_file) %>% 
  read_rds() +
  coord_cartesian(xlim = c(-1, 7.5))

```

***

```{r}
this_pw %>% 
  filter(str_detect(condition, "fibro")) %>% 
  slice(2) %>% 
  pull(pw_forest_file) %>% 
  read_rds()
```

***

```{r}
this_pw %>% 
  filter(str_detect(condition, "fibro")) %>% 
  slice(3) %>% 
  pull(pw_forest_file) %>% 
  read_rds()
```

***
```{r}
this_pw %>% 
  filter(str_detect(condition, "fibro")) %>% 
  slice(4) %>% 
  pull(pw_forest_file) %>% 
  read_rds() +
  coord_cartesian(xlim = c(-1, 5))
  
```

## Adverse events and musculoskeletal

```{r}
this_pw %>% 
  filter(str_detect(condition, "muscu")) %>% 
    select(condition, comp, n_studies, participants) %>% 
  gt(
    groupname_col = "condition"
  ) %>% 
  tab_header("Direct evidence by condition") %>% 
  tab_options(row_group.background.color = hpp_pal(1)
  ) %>% 
  cols_label(
    comp = "Comparison",
    n_studies = "Studies",
    participants = "Participants"
  )



```

***

```{r}
this_pw %>% 
  filter(str_detect(condition, "muscu")) %>% 
  slice(1) %>% 
  pull(pw_forest_file) %>% 
  read_rds()
```

## Adverse events in patients with neuropathic conditions

```{r}
this_pw %>% 
  filter(str_detect(condition, "muscu")) %>% 
    select(condition, comp, n_studies, participants) %>% 
  gt(
    groupname_col = "condition"
  ) %>% 
  tab_header("Direct evidence by condition") %>% 
  tab_options(row_group.background.color = hpp_pal(1)
  ) %>% 
  cols_label(
    comp = "Comparison",
    n_studies = "Studies",
    participants = "Participants"
  )

```

***

```{r}
this_pw %>% 
  filter(str_detect(condition, "muscu")) %>% 
  pull(pw_forest_file) %>% 
  read_rds()

```


## A final look at overall results

```{r}
nma_adverse_plot + 
  facet_grid(class ~ ., scales = "free", space = "free") +
  coord_cartesian(xlim = c(-2, 4))

```

