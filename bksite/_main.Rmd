---
title: "Antidepressants for pain management in adults with chronic pain"
description: |
  A network meta-analysis
site: bookdown::bookdown_site
bibliography: references.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)

knitr::opts_chunk$set(echo = FALSE, warnings = FALSE)

knitr::opts_knit$set(root.dir = "../")

suppressPackageStartupMessages({
  library(tidyverse)
  library(multinma)
  library(targets)
  library(assertthat)
  library(glue)
  library(gt)
})

source("preamble.R")

```


# Overview

```{r}

tar_load(w_obs_m)

```

## Outcomes included

```{r}
w_obs_m %>%
  group_by(outcome) %>% 
  summarise(
    studies = n_distinct(study),
    conditions = unique(condition_general) %>% paste(collapse = ", "),
    timepoint = unique(timepoint) %>% paste(collapse = ", ")
  )

```



## Studies currently included

There are `r w_obs$study %>% unique() %>% length()` currently included.

```{r}
w_obs_m %>% 
  group_by(study) %>% 
  summarise(
    outcome = unique(outcome) %>% paste(collapse = ", "),
    conditions = unique(condition_general) %>% paste(collapse = ", ")
  )

```

## Number of arms per timepoint

```{r}
w_obs_m %>% 
  count(outcome, timepoint)

```


<!--chapter:end:index.Rmd-->

# Pain intensity results

```{r,results='asis', warning=FALSE}
params <- list(outcome = "pain_int")
makechapter(params) -> sink
```

<!--chapter:end:0-pain-int.Rmd-->

# Mood results

```{r,results='asis', warning=FALSE}
params <- list(outcome = "mood")
makechapter(params) -> sink
```

<!--chapter:end:1-mood.Rmd-->

# Moderate pain intensity results

```{r,results='asis', warning=FALSE}
params <- list(outcome = "pain_mod")
makechapter(params) -> sink
```

<!--chapter:end:2-pain-mod.Rmd-->

# Substantial pain results

```{r,results='asis', warning=FALSE}
params <- list(outcome = "pain_sub")
makechapter(params) -> sink
```

<!--chapter:end:3-pain-sub.Rmd-->

# Adverse results

```{r,results='asis', warning=FALSE}
params <- list(outcome = "adverse")
makechapter(params) -> sink
```

<!--chapter:end:4-adverse.Rmd-->

# Quality of life results

```{r,results='asis', warning=FALSE}
params <- list(outcome = "qol")
makechapter(params) -> sink
```

<!--chapter:end:5-qol.Rmd-->

# Sleep results

```{r,results='asis', warning=FALSE}
params <- list(outcome = "sleep")
makechapter(params) -> sink
```

<!--chapter:end:6-sleep.Rmd-->

# Physical function results

```{r,results='asis', warning=FALSE}
params <- list(outcome = "physical")
makechapter(params) -> sink
```

<!--chapter:end:7-physical.Rmd-->

# Withdrawal results

```{r,results='asis', warning=FALSE}
params <- list(outcome = "withdrawal")
makechapter(params) -> sink
```

<!--chapter:end:8-withdrawal.Rmd-->

# Pipeline

## Check figure sizing

```{r results="asis"}
 glue("<img src=\"images/dev/forest.png\" style = 'width:200%;' />") %>%
    cat()
```


## Joining together Covidence export with Hollie's extractions


```{r}
tar_read(w_study_report)


```

    
    
## Labelling protocol for Covidence

```{r load w_obs}
tar_load(w_obs) 

  
```

### Labels not specific to outcome

#### Condition

```{r output levels of w_obs}
w_obs %>% 
  summarise(
    condition_general = unique(condition_general) 
  ) 

```


#### Timepoint or change score

```{r}
w_obs %>% 
  count(timepoint)

```

##### Unmatched timepoints

```{r}
tar_read(w_obs_timepoint) %>% 
  filter(timepoint == "unmatched") %>% 
  select(study, arm, covidence_desc)
```



### Labels specific to outcome

#### Scales

```{r outcome levels}
w_obs %>% 
  group_by(outcome) %>% 
  count(scale) %>% 
  gt(
    groupname_col = "outcome"
  )

```

## Checks

Check that key points in pipeline have the expected number of joins and meets.

```{r}
tar_load(w_covidence)
tar_load(w_obs_long_final)
tar_load(w_cov)
tar_load(w_obs)
```

```{r}
targets <- 
list(
  w_covidence = w_covidence,
  w_cov = w_cov,
  w_obs_long_final = w_obs_long_final
) 

targets %>% 
  map_df(.f = function(df) {
    tibble(
    nrow = nrow(df),
    studies = df$study %>% unique() %>% length(),
    arms = df$arm %>% unique() %>% length()
    )
  }) %>% 
  mutate(
    target = names(targets)
  ) %>% 
  select(target, everything()) %>% 
  gt()


```

## subgroups

### condition

```{r}

```


## Number of arms per study per timepoint

```{r}
w_obs %>% 
  group_by(outcome, timepoint) %>% 
  count(study)

```

<!--chapter:end:9-pipeline.Rmd-->

